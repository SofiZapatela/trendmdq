<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Importar tejidos</title>
</head>
<body>
<h2>Importar tejidos a Firestore</h2>

<input type="file" id="archivo" accept=".json">
<button id="importar">Importar</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// --- CONFIG ---
const firebaseConfig = {
  apiKey: "AIzaSyAMYXqevFiswKZVICllkDVq2ymj6EgBn6I",
  authDomain: "trendmdq-4e495.firebaseapp.com",
  projectId: "trendmdq-4e495",
  storageBucket: "trendmdq-4e495.appspot.com",
  messagingSenderId: "866820424354",
  appId: "1:866820424354:web:548df9c9c21a881a354dfb"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// --- LEER ARCHIVO JSON LOCAL ---
function leerArchivo(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();

    reader.onload = (e) => {
      try {
        resolve(JSON.parse(e.target.result));
      } catch (err) {
        reject(err);
      }
    };

    reader.onerror = reject;
    reader.readAsText(file);
  });
}

document.getElementById("importar").onclick = async () => {
  const file = document.getElementById("archivo").files[0];

  if (!file) return alert("Seleccion√° un archivo tejidos.json");

  const productos = await leerArchivo(file);

  for (const p of productos) {
    let talleArray = [];

    if (p.talle) {
      talleArray = p.talle
        .toString()
        .replace(/\s/g, "")
        .split(",")
        .filter(t => t.length > 0);
    }

    // üî• AC√Å EL CAMBIO IMPORTANTE
    const ref = doc(db, "tejidos", p.slug);

    await setDoc(ref, {
      titulo: p.titulo,
      desc: p.desc,
      precio: p.precio,
      img: p.img,
      href: p.href,
      slug: p.slug,
      tipo: p.tipo ?? "",
      talle: talleArray
    });

    console.log("Importado a tejidos:", p.slug);
  }

  alert("Importaci√≥n de tejidos completa!");
};
</script>

</body>
</html>
